{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InternTrack | Admin Profile</title>
  <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .sidebar-gradient {
      background: linear-gradient(180deg, #003366 0%, #0059b3 100%);
    }

    .card-shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .active-link {
      background-color: rgba(255, 255, 255, 0.2);
      border-left: 3px solid white;
    }
  </style>
</head>

<body class="font-inter bg-gray-50 h-full">
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <div class="sidebar-gradient text-white w-64 md:w-20 lg:w-64 transition-all duration-300 ease-in-out flex-shrink-0">
      <div class="p-4 flex items-center justify-between border-b border-blue-800">
        <h1 class="text-xl font-bold hidden md:block lg:block">InternTrack</h1>
        <i data-feather="menu" class="md:block lg:hidden cursor-pointer"></i>
      </div>
      <nav class="mt-6">
        <div class="px-4 py-3 flex items-center text-white hover:bg-blue-700">
          <i data-feather="home" class="w-5 h-5"></i>
          <a href="{% url 'dashboard' %}" class="ml-3 hidden md:hidden lg:block">Dashboard</a>
        </div>
        <div class="px-4 py-3 flex items-center text-white active-link">
          <i data-feather="user" class="w-5 h-5"></i>
          <span class="ml-3 hidden md:hidden lg:block">Admin Profile</span>
        </div>
        <div class="absolute bottom-0 w-full px-4 py-3 flex items-center text-white hover:bg-blue-700">
          <i data-feather="log-out" class="w-5 h-5"></i>
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="ml-3 hidden md:hidden lg:block">Logout</button>
          </form>
        </div>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-auto">
      <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <div></div>
        <div class="flex items-center space-x-4">
          <div></div>
          <div class="flex items-center space-x-2">
            {% if user.admin_profile.profile_image %}
            <img src="{{ user.admin_profile.profile_image.url }}" alt="Profile" class="w-8 h-8 rounded-full">
            {% else %}
            <img src="{% static 'images/default_profile.png' %}" alt="Profile" class="w-8 h-8 rounded-full">
            {% endif %}
          </div>
        </div>
      </header>

      <main class="p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">My Profile</h2>

        <div class="bg-white rounded-lg p-6 card-shadow max-w-3xl mx-auto">
          <form id="adminProfileForm" enctype="multipart/form-data" class="space-y-4">
            <div class="flex flex-col items-center mb-4">
              <img id="profileImage" src="https://via.placeholder.com/120" alt="Profile Image"
                class="rounded-full w-32 h-32 object-cover mb-4">
              <input type="file" id="profile_image" name="profile_image" class="text-sm text-gray-600">
            </div>

            <div>
              <label class="block font-medium text-gray-700">Full Name</label>
              <input type="text" id="full_name" name="full_name" readonly
                class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2">
            </div>

            <div>
              <label class="block font-medium text-gray-700">Employee ID</label>
              <input type="text" id="employee_id" name="employee_id" readonly
                class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2" readonly>
            </div>

            <div>
              <label class="block font-medium text-gray-700">Department</label>
              <input type="text" id="department" name="department" readonly
                class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2">
            </div>

            <div>
              <label class="block font-medium text-gray-700">Position</label>
              <input type="text" id="position" name="position" readonly
                class="mt-1 w-full border border-gray-300 rounded-md px-3 py-2">
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">Update
              Profile</button>
          </form>
        </div>
      </main>
    </div>
  </div>

  <script src="{% static 'js/script.js' %}"></script>
  <script>
    feather.replace();

    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          cookie = cookie.trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');
    const apiUrl = '/profile/admin/';

    async function loadAdminProfile() {
      const response = await fetch(apiUrl);
      const data = await response.json();

      document.getElementById('full_name').value = data.full_name || '';
      document.getElementById('employee_id').value = data.employee_id || '';
      document.getElementById('department').value = data.department || '';
      document.getElementById('position').value = data.position || '';
      document.getElementById('profileImage').src = data.profile_image || 'https://via.placeholder.com/120';
    }

    document.getElementById('adminProfileForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const formData = new FormData();
      formData.append('employee_id', document.getElementById('employee_id').value);
      formData.append('department', document.getElementById('department').value);
      formData.append('position', document.getElementById('position').value);

      const imageFile = document.getElementById('profile_image').files[0];
      if (imageFile) formData.append('profile_image', imageFile);

      const response = await fetch(apiUrl, {
        method: 'PUT',
        headers: { 'X-CSRFToken': csrftoken },
        body: formData
      });

      if (response.ok) {
        alert('Profile updated successfully!');
        loadAdminProfile();
      } else {
        alert('Error updating profile.');
      }
    });

    loadAdminProfile();
  </script>
</body>

</html>